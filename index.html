<style>
    /* Add a subtle scanline effect to the console for realism */
    #console::before {
        content: " ";
        display: block;
        position: absolute;
        top: 0; left: 0; bottom: 0; right: 0;
        background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), 
                    linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
        z-index: 2;
        background-size: 100% 3px, 3px 100%;
        pointer-events: none;
    }
    
    .error-line { color: var(--danger); font-style: italic; opacity: 0.8; }
    .searching { color: var(--warning); font-size: 12px; }
</style>

<script>
const consoleEl = document.getElementById("console");

// SLOWER TYPING: Changed delay from 20 to 50 for a "Mechanical" feel
async function print(text, delay = 50, isError = false) {
    const div = document.createElement("div");
    div.className = isError ? "line error-line" : "line";
    consoleEl.appendChild(div);
    
    for (let char of text) {
        div.innerHTML += char;
        await new Promise(r => setTimeout(r, delay));
        consoleEl.scrollTop = consoleEl.scrollHeight;
    }
}

async function processCommand(cmd) {
    if (!cmd) return;

    // Show "Searching" feedback before the result
    const searchDiv = document.createElement("div");
    searchDiv.className = "line searching";
    searchDiv.innerHTML = `> Querying internal database for '${cmd}'...`;
    consoleEl.appendChild(searchDiv);
    
    // 1.5 second "Simulation Delay" to make it feel like a real search
    await new Promise(r => setTimeout(r, 1500));
    searchDiv.remove();
    
    switch(cmd) {
        case "help":
            await print("[LISTING ACCESSIBLE MODULES]");
            await print("1. SCAN - Heuristic System Audit");
            await print("2. TRACE - Network Route Mapping");
            await print("3. CLEAR - Purge Terminal Buffer");
            await print("4. SYSTEM - View Local Node Specs");
            break;

        case "scan":
            await print("[!] Initializing deep-layer audit...", 100);
            await new Promise(r => setTimeout(r, 1000));
            await print("[+] Result: System Integrity 100% (40/40 confirmed).");
            break;

        case "system":
            await print(`[ID] ARCH-PRODIGY-09`);
            await print(`[OS] Archangel-Core v5.2 (Unix-like)`);
            await print(`[COORDS] ${document.getElementById("ip").innerText}`);
            break;

        case "clear":
            consoleEl.innerHTML = "";
            break;

        // THE "BETTER" ERROR HANDLING
        default:
            const errorTypes = [
                `[-] UNIDENTIFIED_COMMAND: '${cmd}' does not exist in the /bin directory.`,
                `[!] ACCESS_DENIED: User 'PRODIGY_40' does not have permission for '${cmd}'.`,
                `[-] KERNEL_ERROR: Instruction pointer overflow at '${cmd}'.`,
                `[?] '${cmd}' is not recognized as an internal or external command.`
            ];
            // Randomly picks an "Error" style to make it look smarter
            const randomError = errorTypes[Math.floor(Math.random() * errorTypes.length)];
            await print(randomError, 40, true);
            
            // Add to a secret security log in the console
            console.warn(`Intrusion Alert: Unrecognized command '${cmd}' logged to /var/log/security.`);
    }
}

// Ensure the prompt function is called after the first print
print("ARCHANGEL // DEEP DATA LINK ESTABLISHED", 30).then(prompt);
</script>
